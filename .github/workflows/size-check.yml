name: PR Size Check
on:
  pull_request:
jobs:
  check-size:
    runs-on: ubuntu-latest
    env:
      MAX_LINES: 700
    steps:
      - name: Check if should skip
        id: should_skip
        run: |
          if echo "${{ github.event.pull_request.title }}" | grep -qi "\[skip-line-limit\]"; then
            echo "skip=true" >> $GITHUB_OUTPUT
            echo "âœ“ Skipping line limit check (found [skip-line-limit] in PR title)"
          else
            echo "skip=false" >> $GITHUB_OUTPUT
          fi
      - uses: actions/checkout@v4
        if: steps.should_skip.outputs.skip == 'false'
        with:
          fetch-depth: 0
      - name: Check PR size
        if: steps.should_skip.outputs.skip == 'false'
        run: |
          git fetch origin ${{ github.base_ref }}
          # Count changed lines excluding whitespace, comments, and lock files
          CHANGED_LINES=$(bash ./scripts/check-size.sh ${{ github.base_ref }})
          echo "Changed lines (excluding whitespace, comments, and lock files): ${CHANGED_LINES}"
          echo "Maximum allowed: $MAX_LINES"
          if [ "${CHANGED_LINES}" -gt "$MAX_LINES" ]; then
            echo "::error::PR is too large ($CHANGED_LINES lines). Max: $MAX_LINES lines."
            exit 1
          fi
