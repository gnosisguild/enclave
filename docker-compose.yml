services:
  ciphernode:
    build:
      context: .
      dockerfile: ./packages/ciphernode/Dockerfile
    image: ciphernode:latest
    volumes:
      - ${CONFIG_FILE}:/home/ciphernode/.config/enclave/config.yaml:ro  # Read-only config directory
      - ${SECRETS_FILE}:/home/ciphernode/secrets/secrets.json:ro  # Read-only secrets directory
      - ciphernode-data:/home/ciphernode/.local/share/enclave  # Persistent data
    environment:
      RUST_LOG: "info"
      AGGREGATOR: "false"
    restart: unless-stopped

volumes:
  ciphernode-data:
