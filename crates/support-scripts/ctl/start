#!/usr/bin/env bash

unset RISC0_DEV_MODE RPC_URL PRIVATE_KEY PINATA_JWT PROGRAM_URL BOUNDLESS_ONCHAIN

while [[ $# -gt 0 ]]; do
  case $1 in
    --risc0-dev-mode)
      RISC0_DEV_MODE="$2"
      shift 2
      ;;
    --rpc-url)
      RPC_URL="$2"
      shift 2
      ;;
    --private-key)
      PRIVATE_KEY="$2"
      shift 2
      ;;
    --pinata-jwt)
      PINATA_JWT="$2"
      shift 2
      ;;
    --program-url)
      PROGRAM_URL="$2"
      shift 2
      ;;
    --boundless-onchain)
      BOUNDLESS_ONCHAIN="$2"
      shift 2
      ;;
    *)
      echo "Unknown argument: $1"
      exit 1
      ;;
  esac
done

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CONTAINER_ARGS=("./scripts/container/start.sh")

if [[ -n "$RISC0_DEV_MODE" ]]; then
  CONTAINER_ARGS+=("--risc0-dev-mode" "$RISC0_DEV_MODE")
fi

if [[ -n "$RPC_URL" && -n "$PRIVATE_KEY" ]]; then
  CONTAINER_ARGS+=("--rpc-url" "$RPC_URL")
  CONTAINER_ARGS+=("--private-key" "$PRIVATE_KEY")
elif [[ -n "$RPC_URL" || -n "$PRIVATE_KEY" ]]; then
  echo "Error: Both --rpc-url and --private-key must be provided together, or neither"
  exit 1
fi

if [[ -n "$PINATA_JWT" ]]; then
  CONTAINER_ARGS+=("--pinata-jwt" "$PINATA_JWT")
fi

if [[ -n "$PROGRAM_URL" ]]; then
  CONTAINER_ARGS+=("--program-url" "$PROGRAM_URL")
fi

if [[ -n "$BOUNDLESS_ONCHAIN" ]]; then
  CONTAINER_ARGS+=("--boundless-onchain" "$BOUNDLESS_ONCHAIN")
fi

exec "$SCRIPT_DIR/container" "${CONTAINER_ARGS[@]}"