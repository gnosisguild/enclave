x-common-variables: &common-variables
  SYNC_THRESHOLD: 6

services:
  alice:
    image: p2p_test:latest
    command: ["/app/p2p_test", "alice"]
    environment:
      <<: *common-variables
      QUIC_PORT: 9091
      DIAL_TO: "/dns4/charlie/udp/9091/quic-v1"
      TEST_CONFIG: "lead"
    networks:
      - p2p_test_net

  bob:
    image: p2p_test:latest 
    command: ["/app/p2p_test", "bob"]
    environment:
      <<: *common-variables
      QUIC_PORT: 9091
      DIAL_TO: "/dns4/charlie/udp/9091/quic-v1"
    networks:
      - p2p_test_net

  charlie:
    image: p2p_test:latest 
    command: ["/app/p2p_test", "charlie"]
    environment:
      <<: *common-variables
      QUIC_PORT: 9091
    networks:
      - p2p_test_net

  daniel:
    image: p2p_test:latest 
    command: ["/app/p2p_test", "daniel"]
    environment:
      <<: *common-variables
      QUIC_PORT: 9091
      DIAL_TO: "/dns4/charlie/udp/9091/quic-v1"
    networks:
      - p2p_test_net

  eve:
    image: p2p_test:latest 
    command: ["/app/p2p_test", "eve"]
    environment:
      <<: *common-variables
      QUIC_PORT: 9091
      DIAL_TO: "/dns4/charlie/udp/9091/quic-v1"
    networks:
      - p2p_test_net

  fabian:
    image: p2p_test:latest 
    command: ["/app/p2p_test", "fabian"]
    environment:
      <<: *common-variables
      QUIC_PORT: 9091
      DIAL_TO: "/dns4/charlie/udp/9091/quic-v1"
    networks:
      - p2p_test_net

networks:
  p2p_test_net:
    driver: bridge
